---
# yaml-language-server: $schema=https://raw.githubusercontent.com/yannh/kubernetes-json-schema/master/master-standalone-strict/deployment.json
apiVersion: apps/v1
kind: Deployment
metadata:
  name: &name mltb
  annotations:
    reloader.stakater.com/auto: "true"
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: *name
  template:
    metadata:
      name: *name
    spec:
      containers:
        - name: *name
          image: ghcr.io/kevinnitrog/homelab/mltb:615a34a89f7768ee3b36f1f53889dc537741d7b3
          ports:
            - name: rclone
              containerPort: 8080
            - name: base
              containerPort: 80
            - name: sth
              containerPort: 8090
            - name: sth-i
              containerPort: 8070
          envFrom:
            - secretRef:
                name: mltb-mltb
                optional: false
            - configMapRef:
                name: mltb-mltb
                optional: false
          volumeMounts:
            - name: &sa-account mltb-sa-accounts
              mountPath: /usr/src/app/accounts/
              readOnly: true
            - name: &sa-token mltb-sa-token
              mountPath: /usr/src/app/token_sa.pickle
              subPath: token_sa.pickle
              readOnly: true
      volumes:
        - name: *sa-account
          secret:
            secretName: *sa-account
            optional: false
        - name: *sa-token
          secret:
            secretName: *sa-token
            optional: false
